<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPG Panel - Advanced</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { display: flex; background-color: #121212; color: #e0e0e0; height: 100vh; overflow: hidden; }
        ::-webkit-scrollbar { width: 8px; } ::-webkit-scrollbar-track { background: #1a1a1a; } ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        
        #auth-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #0f0c29, #302b63, #24243e); display: flex; justify-content: center; align-items: center; z-index: 100; }
        .auth-box { background: rgba(255, 255, 255, 0.05); padding: 40px; border-radius: 15px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); width: 350px; text-align: center; }
        .auth-box input { width: 100%; padding: 12px; margin: 10px 0; background: rgba(0,0,0,0.3); border: 1px solid #444; color: #fff; border-radius: 5px; outline:none; }
        .btn-auth { width: 100%; padding: 12px; background: #00ff88; border: none; color: #000; font-weight: bold; cursor: pointer; border-radius: 5px; margin-top: 10px; }
        .switch-auth { margin-top: 15px; font-size: 12px; cursor: pointer; color: #aaa; text-decoration: underline; }

        #dashboard-container { display: none; width: 100%; height: 100%; display: flex; }
        .sidebar { width: 260px; background: #1a1a1a; padding: 25px; border-right: 1px solid #2a2a2a; display: flex; flex-direction: column; }
        .sidebar ul li { list-style: none; margin-bottom: 10px; }
        .sidebar a { text-decoration: none; color: #aaa; display: flex; align-items: center; padding: 12px; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .sidebar a:hover, .active a { background: rgba(0, 255, 136, 0.1); color: #00ff88; }
        
        .main-content { flex: 1; padding: 40px; overflow-y: auto; background: #141414; }
        
        /* Dashboard Stats */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 25px; margin-bottom: 30px; }
        .card { background: #1f1f1f; padding: 25px; border-radius: 12px; border: 1px solid #2a2a2a; }
        .card h3 { font-size: 13px; color: #888; margin-bottom: 5px; } 
        .card p { font-size: 26px; font-weight: bold; color: #fff; }
        
        /* Profile Layout Restore */
        .profile-header-card { background: #1f1f1f; border-radius: 12px; padding: 30px; margin-bottom: 25px; display: flex; flex-direction: column; align-items: center; border: 1px solid #2a2a2a; }
        .big-avatar { width: 100px; height: 100px; border-radius: 50%; border: 3px solid #00ff88; margin-bottom: 15px; }
        .badges-container { display: flex; gap: 10px; margin-top: 10px; }
        .badge { padding: 5px 15px; border-radius: 20px; font-size: 12px; font-weight: bold; color: #fff; }
        .badge-vip { background: linear-gradient(45deg, #f1c40f, #f39c12); color: #000; }
        .badge-premium { background: linear-gradient(45deg, #9b59b6, #8e44ad); }

        .profile-layout { display: grid; grid-template-columns: 300px 1fr; gap: 30px; }
        
        /* Backpack Styles */
        .backpack-item { display: flex; align-items: center; gap: 15px; padding: 10px; background: #181818; border-radius: 8px; margin-top: 10px; border: 1px solid #333; }
        .backpack-icon { color: #00ff88; font-size: 24px; }

        /* Tabs */
        .profile-tabs { display: flex; gap: 20px; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .tab-btn { color: #888; cursor: pointer; padding: 10px; font-weight: 500; }
        .tab-btn.active-tab { color: #00ff88; border-bottom: 2px solid #00ff88; }

        .data-row { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid #2a2a2a; font-size: 14px; }
        .data-label { color: #888; } .data-value { color: #fff; font-weight: 600; }
        
        .page-section { display: none; }
        .active-page { display: block; }
        .email-warning { background: rgba(255, 77, 77, 0.1); border: 1px solid #ff4d4d; color: #ff4d4d; padding: 12px 20px; border-radius: 8px; margin-bottom: 30px; display: none; align-items: center; justify-content: space-between; }

        @media (max-width: 900px) { .profile-layout { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <div id="auth-container">
        <div class="auth-box" id="login-form">
            <h2>üîê Login Panel</h2>
            <input type="email" id="login-email" placeholder="Email">
            <input type="password" id="login-pass" placeholder="ParolƒÉ">
            <button class="btn-auth" onclick="loginUser()">IntrƒÉ √Æn cont</button>
            <p class="switch-auth" onclick="toggleForms()">Nu ai cont? √énregistreazƒÉ-te</p>
        </div>
        <div class="auth-box" id="register-form" style="display: none;">
            <h2>üìù √énregistrare</h2>
            <input type="text" id="reg-roblox" placeholder="Nume Exact Roblox (ex: sbyk)">
            <input type="email" id="reg-email" placeholder="Email">
            <input type="password" id="reg-pass" placeholder="ParolƒÉ">
            <button class="btn-auth" onclick="registerUser()">CreeazƒÉ Cont</button>
            <p class="switch-auth" onclick="toggleForms()">Ai deja cont? LogheazƒÉ-te</p>
        </div>
    </div>

    <div id="dashboard-container">
        <div class="sidebar">
            <h2 style="color:#fff; text-align:center; margin-bottom:40px;">SEVID<span style="color:#00ff88">STUDIOS</span></h2>
            <ul>
                <li class="active" id="nav-dashboard" onclick="switchPage('dashboard')"><a><i class="fas fa-chart-line" style="margin-right:10px"></i> Dashboard</a></li>
                <li id="nav-profile" onclick="switchPage('profile')"><a><i class="fas fa-user-circle" style="margin-right:10px"></i> Profilul Meu</a></li>
                <li><a><i class="fas fa-users" style="margin-right:10px"></i> Fac»õiuni</a></li>
                <li><a><i class="fas fa-file-contract" style="margin-right:10px"></i> Reclama»õii</a></li>
                <li><a><i class="fas fa-store" style="margin-right:10px"></i> Shop Premium</a></li>
            </ul>
            <div class="logout" style="margin-top:auto;"><a onclick="logoutUser()"><i class="fas fa-sign-out-alt" style="margin-right:10px"></i> Ie»ôire</a></div>
        </div>

        <div class="main-content">
            <div id="email-alert" class="email-warning">
                <div><i class="fas fa-exclamation-triangle"></i> Email neconfirmat!</div>
                <button onclick="resendVerification()" style="background:none; border:none; color:#fff; text-decoration:underline; cursor:pointer;">Retrimite</button>
            </div>

            <h1 id="page-title" style="color:#fff; margin-bottom:30px;">Dashboard</h1>

            <div id="page-dashboard" class="page-section active-page">
                <div class="stats-grid">
                    <div class="card"><i class="fas fa-wallet" style="color:#00ff88;"></i><h3>BANI CASH</h3><p id="dash-cash">$0</p></div>
                    <div class="card"><i class="fas fa-university" style="color:#00ff88;"></i><h3>BANI BANCƒÇ</h3><p id="dash-bank">$0</p></div>
                    <div class="card"><i class="fas fa-briefcase" style="color:#00ff88;"></i><h3>JOB</h3><p id="dash-job">N/A</p></div>
                    <div class="card"><i class="fas fa-clock" style="color:#00ff88;"></i><h3>ORE</h3><p id="dash-hours">0</p></div>
                </div>
                <div style="color: #666; font-size: 12px; margin-top:20px;">
                    Debug: <span id="debug-msg">A»ôteptare conectare...</span> <br>
                    (DacƒÉ vezi "Jucator" »ôi nu numele tƒÉu, scrie √Æn consolƒÉ: <b>schimbaNume("sbyk")</b> »ôi dƒÉ refresh)
                </div>
            </div>

            <div id="page-profile" class="page-section">
                <div class="profile-header-card">
                    <img src="" id="prof-big-avatar" class="big-avatar">
                    <h2 id="prof-name" style="color:#fff; margin-top:10px;">Jucator</h2>
                    <span style="color:#00ff88; font-size:14px; margin-top:5px;">‚óè Online pe Panel</span>
                    <div class="badges-container">
                        <span class="badge badge-vip"><i class="fas fa-crown"></i> VIP</span>
                        <span class="badge badge-premium"><i class="fas fa-gem"></i> Premium</span>
                    </div>
                </div>

                <div class="profile-layout">
                    <div class="profile-sidebar">
                        <div style="background:#1f1f1f; padding:20px; border-radius:12px; border:1px solid #2a2a2a;">
                            <h4 style="color:#fff; border-bottom:1px solid #333; padding-bottom:10px; margin-bottom:10px;">Backpack</h4>
                            <div class="backpack-item">
                                <i class="fas fa-box backpack-icon"></i>
                                <div><div style="color:#fff; font-weight:600;">High Quality Kit</div><div style="color:#666; font-size:12px;">Repara»õii</div></div>
                            </div>
                            <div class="backpack-item">
                                <i class="fas fa-mobile-alt backpack-icon" style="color:#3498db"></i>
                                <div><div style="color:#fff; font-weight:600;">iPhone 14</div><div style="color:#666; font-size:12px;">Telefon</div></div>
                            </div>
                            <div class="backpack-item" style="margin-top:20px; border-color:#00ff88;">
                                <i class="fas fa-car backpack-icon"></i>
                                <div><div style="color:#fff; font-weight:600;">Garaj</div><div style="color:#666; font-size:12px;" id="prof-cars">0 Vehicule</div></div>
                            </div>
                        </div>
                    </div>

                    <div class="profile-main">
                        <div class="profile-tabs">
                            <div class="tab-btn active-tab"><i class="fas fa-user"></i> Profile</div>
                            <div class="tab-btn"><i class="fas fa-home"></i> Properties</div>
                            <div class="tab-btn"><i class="fas fa-dumbbell"></i> Skills</div>
                            <div class="tab-btn"><i class="fas fa-history"></i> Faction History</div>
                        </div>

                        <div style="background:#1f1f1f; padding:25px; border-radius:12px; border:1px solid #2a2a2a;">
                            <div class="data-row"><span class="data-label">Faction</span><span class="data-value" id="prof-faction" style="color:#3498db">Civil</span></div>
                            <div class="data-row"><span class="data-label">Rank</span><span class="data-value" id="prof-rank">0</span></div>
                            <div class="data-row"><span class="data-label">Level</span><span class="data-value" id="prof-level">1</span></div>
                            <div class="data-row"><span class="data-label">Respect Points</span><span class="data-value" id="prof-rp">0</span></div>
                            <div class="data-row"><span class="data-label">Playing Hours</span><span class="data-value" id="prof-hours-2">0</span></div>
                            <div class="data-row"><span class="data-label">Phone</span><span class="data-value" id="prof-phone">...</span></div>
                            <div class="data-row"><span class="data-label">Job</span><span class="data-value" id="prof-job-2" style="color:#f39c12">Somer</span></div>
                            <div class="data-row"><span class="data-label">Last Online</span><span class="data-value" id="prof-seen">...</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, sendEmailVerification } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js";
        import { getDatabase, ref, set, get, child, update } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-database.js";

        // CONFIGURAREA TA
        const firebaseConfig = {
            apiKey: "AIzaSyDwD_aL4yioTc16MOCxz7cVec_eSKfABlo",
            authDomain: "projsmprobl.firebaseapp.com",
            databaseURL: "https://projsmprobl-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "projsmprobl",
            storageBucket: "projsmprobl.firebasestorage.app",
            messagingSenderId: "1024885479778",
            appId: "1:1024885479778:web:3ae2eab4fe383b76e8b43b",
            measurementId: "G-MNHTTG5XBB"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        // --- REPARARE CONT (Acum va merge dupa ce pui regulile in Firebase) ---
        window.schimbaNume = function(numeNou) {
            if(auth.currentUser) {
                update(ref(db, 'site_users/' + auth.currentUser.uid), { robloxUsername: numeNou })
                .then(() => { alert("Succes! Nume schimbat √Æn " + numeNou + ". DƒÉ refresh la paginƒÉ."); location.reload(); })
                .catch((e) => { alert("Tot nu merge? Ai pus regulile in Firebase Console?"); console.error(e); });
            } else { console.log("Trebuie sa fii logat!"); }
        }

        // --- NAVIGARE ---
        window.switchPage = function(pageId) {
            document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active-page'));
            document.querySelectorAll('.sidebar li').forEach(el => el.classList.remove('active'));
            document.getElementById('page-' + pageId).classList.add('active-page');
            document.getElementById('nav-' + pageId).classList.add('active');
            const titluri = {'dashboard': 'Dashboard', 'profile': 'Profilul Meu'};
            document.getElementById('page-title').innerText = titluri[pageId];
        }

        // --- AUTH ---
        window.toggleForms = function() {
            const login = document.getElementById('login-form');
            const reg = document.getElementById('register-form');
            if(login.style.display === 'none') { login.style.display = 'block'; reg.style.display = 'none'; }
            else { login.style.display = 'none'; reg.style.display = 'block'; }
        }

        window.registerUser = function() {
            const robloxName = document.getElementById('reg-roblox').value;
            const email = document.getElementById('reg-email').value;
            const pass = document.getElementById('reg-pass').value;
            if(!robloxName || !email || !pass) { alert("CompleteazƒÉ tot!"); return; }

            createUserWithEmailAndPassword(auth, email, pass).then((uc) => {
                set(ref(db, 'site_users/' + uc.user.uid), { robloxUsername: robloxName, email: email });
                sendEmailVerification(uc.user).then(() => { alert("Cont creat! VerificƒÉ mail-ul."); toggleForms(); });
            }).catch((e) => alert("Eroare: " + e.message));
        }

        window.loginUser = function() {
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-pass').value;
            signInWithEmailAndPassword(auth, email, pass).catch((e) => alert("Eroare: " + e.message));
        }

        window.logoutUser = function() { signOut(auth).then(() => location.reload()); }
        window.resendVerification = function() { if(auth.currentUser) sendEmailVerification(auth.currentUser).then(()=>alert("Trimis!")); }

        // --- DATA LOAD ---
        onAuthStateChanged(auth, async (user) => {
            const authDiv = document.getElementById('auth-container');
            const dashDiv = document.getElementById('dashboard-container');

            if (user) {
                authDiv.style.display = 'none';
                dashDiv.style.display = 'flex';

                if (!user.emailVerified) {
                    document.getElementById('email-alert').style.display = 'flex';
                } else {
                    document.getElementById('email-alert').style.display = 'none';
                }

                const snapshot = await get(child(ref(db), `site_users/${user.uid}`));
                if (snapshot.exists()) {
                    const myRobloxName = snapshot.val().robloxUsername;
                    document.getElementById('debug-msg').innerText = "Conectat ca: " + myRobloxName;
                    incarcaStats(myRobloxName);
                } else {
                    document.getElementById('debug-msg').innerText = "Cont fƒÉrƒÉ nume Roblox. Folose»ôte consola: schimbaNume('sbyk')";
                }
            } else {
                authDiv.style.display = 'flex';
                dashDiv.style.display = 'none';
            }
        });

        async function incarcaStats(numeRoblox) {
            try {
                const snapshot = await get(child(ref(db), `users/${numeRoblox}`));
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    
                    // Dashboard
                    document.getElementById('dash-cash').innerText = "$" + (data.banii_cash || 0).toLocaleString();
                    document.getElementById('dash-bank').innerText = "$" + (data.banii_banca || 0).toLocaleString();
                    document.getElementById('dash-job').innerText = data.job_curent || "N/A";
                    document.getElementById('dash-hours').innerText = data.ore_jucate || 0;

                    // Profil
                    document.getElementById('prof-name').innerText = numeRoblox;
                    if(data.avatar_url) document.getElementById('prof-big-avatar').src = data.avatar_url;
                    if(data.avatar_url) document.getElementById('miniAvatar').src = data.avatar_url;
                    
                    document.getElementById('prof-faction').innerText = data.factiune || "Civil";
                    document.getElementById('prof-rank').innerText = data.rank || 0;
                    document.getElementById('prof-level').innerText = data.level || 1;
                    document.getElementById('prof-rp').innerText = data.rp || 0;
                    document.getElementById('prof-hours-2').innerText = data.ore_jucate || 0;
                    document.getElementById('prof-phone').innerText = data.telefon || "...";
                    document.getElementById('prof-job-2').innerText = data.job_curent || "N/A";
                    document.getElementById('prof-cars').innerText = (data.masini_detinute || 0) + " Vehicule";
                    if(data.last_online) document.getElementById('prof-seen').innerText = data.last_online;

                } else {
                    document.getElementById('debug-msg').innerText = "Nu s-au gƒÉsit date √Æn joc pentru: " + numeRoblox;
                }
            } catch (e) { console.error(e); }
        }

        setInterval(async () => {
            if (auth.currentUser && !auth.currentUser.emailVerified) {
                await auth.currentUser.reload();
                if (auth.currentUser.emailVerified) document.getElementById('email-alert').style.display = 'none';
            }
        }, 5000);
    </script>
</body>
</html>
